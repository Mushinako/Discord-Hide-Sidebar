"use strict";function discordHideSidebar(){const e=document.getElementsByClassName(bannerClassName);if(1!==e.length)return;const t=e[0];if(t.classList.contains(initClassName))return;const i=document.getElementsByClassName(sidebarClassName);if(1===i.length){if(void 0===buttonDiv){buttonDiv=document.createElement("div"),buttonDiv.classList.add(...buttonClassNames);for(const[e,t]of Object.entries(buttonAttributes))buttonDiv.setAttribute(e,t)}sidebarDiv=i[0],loadConfig(),buttonDiv.addEventListener("click",toggleSidebar),sidebarDiv.style.transition=`width ${animTime}s ease-in-out`,t.appendChild(buttonDiv),document.body.classList.contains(keyMarkClassName)||(document.addEventListener("keydown",keyHandler),document.body.classList.add(keyMarkClassName)),t.classList.add(initClassName),firstRunSuccess=!0}}async function loadConfig(){!0!==processingFlag&&(processingFlag=!0,"1"===await getCache()?hideSide():showSide(),processingFlag=!1)}function toggleSidebar(){!0!==processingFlag&&(processingFlag=!0,buttonDiv.classList.contains(hiddenClassName)?showSide():hideSide(),processingFlag=!1)}function hideSide(){if(setCache("1"),void 0===buttonDiv||void 0===sidebarDiv)return;if(buttonDiv.classList.add(hiddenClassName),buttonDiv.innerHTML=svgRight,sidebarDiv.style.width=hiddenWidth,sidebarDiv.style.height=hiddenHeight,sidebarDiv.classList.contains(sidebarMarkClassName))return;const e=document.createElement("div");e.style.width=hiddenWidth;const t=sidebarDiv.parentElement.parentElement,i=document.createElement("div");setTimeout(()=>{sidebarDiv.parentElement.insertBefore(e,sidebarDiv),i.appendChild(sidebarDiv),i.style.position="absolute",i.style.zIndex="2",t.appendChild(i),sidebarDiv.addEventListener("mouseenter",mouseEnterHandler),sidebarDiv.addEventListener("mouseleave",mouseLeaveHandler),sidebarDiv.classList.add(sidebarMarkClassName)},animTimeMs)}function showSide(){if(setCache("0"),void 0===buttonDiv||void 0===sidebarDiv)return;if(buttonDiv.classList.remove(hiddenClassName),buttonDiv.innerHTML=svgLeft,!sidebarDiv.classList.contains(sidebarMarkClassName))return void(sidebarDiv.style.width="");const e=sidebarDiv.parentElement.parentElement,t=e.children[e.childElementCount-2];if(2!==t.childElementCount)throw new ReferenceError("Invalid showSide parent");t.removeChild(t.firstElementChild),t.insertBefore(sidebarDiv,t.firstElementChild),setTimeout(()=>{sidebarDiv.style.width="",sidebarDiv.style.height=""},100),sidebarDiv.removeEventListener("mouseenter",mouseEnterHandler),sidebarDiv.removeEventListener("mouseleave",mouseLeaveHandler),sidebarDiv.classList.remove(sidebarMarkClassName),e.childElementCount>1&&e.removeChild(e.lastElementChild)}function mouseEnterHandler(e){timeoutId=setTimeout(()=>{e.target.style.width=""},100)}function mouseLeaveHandler(e){clearTimeout(timeoutId),timeoutId=void 0,e.target.style.width=hiddenWidth}function keyHandler(e){if(e.ctrlKey)return"L"===e.key?void discordHideSidebar():"l"===e.key?void toggleSidebar():"w"===e.key?void window.close():void 0;"PageDown"===e.key&&e.altKey&&scrollToBottom()}function scrollToBottom(){const e=document.getElementsByClassName(jumpButtonClassName);for(const t of e){const e=t.firstChild.textContent.trim();if(e===jumpToPresentText)return void t.click()}const t=document.getElementsByClassName(scrollerClassName);if(1!==t.length)throw ReferenceError("Invalid scroller div");const i=t[0],s={top:i.scrollHeight,left:i.scrollLeft,behavior:"smooth"};i.scrollTo(s)}function getServerUrl(){const e=location.pathname.split("/");return e.length<3?null:e[2]===meServerName||/^\d+$/.test(e[2])?"/"+e[2]:null}async function getCache(){const e=getServerUrl();if(null===e)return null;const t=await cache.match(e);return void 0===t?null:await t.text()}function setCache(e){const t=getServerUrl();null!==t&&cache.put(t,new Response(e))}function clearCache(){cache.keys().then(e=>{for(const t of e)cache.delete(t)})}function getMutationObTarget(e,t){const i=document.getElementsByClassName(e);if(1!==i.length)throw new ReferenceError(`Incorrect window ${t}`);return i[0]}function checkSidebarMutation(){discordHideSidebar(),setCombinedMutationCheck(),setRightsideMutationCheck()}function checkRightsideMutation(){discordHideSidebar()}function setSidebarMutationCheck(){const e=getMutationObTarget(sidebarClassName,"sidebar");void 0!==sidebarOb&&sidebarOb.disconnect(),sidebarOb=new MutationObserver(checkSidebarMutation),sidebarOb.observe(e,mutationObConf)}function setRightsideMutationCheck(){try{var e=getMutationObTarget(rightsideClassName,"right side")}catch(e){return}void 0!==rightsideOb&&rightsideOb.disconnect(),rightsideOb=new MutationObserver(checkRightsideMutation),rightsideOb.observe(e,mutationObConf)}function setCombinedMutationCheck(){const e=getMutationObTarget(combinedClassName,"combined");void 0!==combinedOb&&combinedOb.disconnect(),combinedOb=new MutationObserver(checkRightsideMutation),combinedOb.observe(e,mutationObConf)}var persist=void 0,cache=void 0,meServerName="@me",hiddenClassName="hide-side",initClassName="hide-sidebar-init",bannerClassName="toolbar-1t6TWx",serverClassName="wrapper-1Rf91z",sidebarClassName="sidebar-2K8pFh",rightsideClassName="chat-3bRxxu",combinedClassName="content-98HsJk",scrollerClassName="scroller-2LSbBU",jumpButtonClassName="barButtonAlt-mYL1lj",keyMarkClassName="key-el",sidebarMarkClassName="sidebar-el",jumpToPresentText="Jump To Present",buttonClassNames=["iconWrapper-2OrFZ1","clickable-3rdHwn","focusable-1YV_-H"],buttonAttributes={role:"button","aria-label":"Toggle Sidebar",tabindex:"0"},mutationObConf={childList:!0},hiddenWidth="20px",hiddenHeight="calc(100vh - 22px)",firstRunSuccess=!1,timeoutId=void 0,processingFlag=!1,preSvg='<svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="',postSvg='"></path></svg>',svgLeft=preSvg+"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"+postSvg,svgRight=preSvg+"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"+postSvg,sidebarDiv=void 0,buttonDiv=void 0,sidebarOb=void 0,rightsideOb=void 0,combinedOb=void 0,animTime=.2,animTimeMs=1e3*animTime,sleep=e=>new Promise(t=>setTimeout(t,e));(async()=>{for(persist=await navigator.storage.persist(),persist||console.log("%cOh no no save","color:red;font-size:96px;-webkit-text-stroke:2px yellow;"),cache=await caches.open(hiddenClassName);!firstRunSuccess;)await sleep(1e3),discordHideSidebar();setSidebarMutationCheck(),setCombinedMutationCheck(),setRightsideMutationCheck()})();